<dataConfig>
    <dataSource type="JdbcDataSource" driver="org.postgresql.Driver" url="jdbc:postgresql://localhost:5432/oipa" user="zimmerman" password="" />
    <document>
        <entity 
            name="activity_result" 
            query="
                SELECT
                    CONCAT(iati_activity.iati_identifier, '-result-', iati_result.id) AS activity_iati_indentifier_and_result_id,
                    iati_activity.iati_identifier as iati_identifier,
                    CASE WHEN humanitarian=TRUE THEN '1' ELSE CASE WHEN humanitarian=FALSE THEN '0' END END AS humanitarian,
                    iati_result.id as id,
                    activity_id,
                    type_id,
                    CASE WHEN iati_result.aggregation_status=TRUE THEN '1' ELSE '0' END AS aggregation_status
                FROM iati_result, iati_activity
                WHERE activity_id=iati_activity.id
            "
        >
            <field column="activity_iati_indentifier_and_result_id" name="id"/>
            <field column="iati_identifier" name="iati_identifier"/>
            <field column="humanitarian" name="humanitarian"/>
            <field column="type_id" name="result_type"/>
            <field column="aggregation_status" name="result_aggregation_status"/>
            <entity name="activity_reporting_org" 
                query="
                    SELECT 
                        organisation_id,
                        ref 
                    FROM iati_activityreportingorganisation 
                    WHERE activity_id=${activity_result.activity_id} LIMIT 1
                "
            >
                <field column="ref" name="reporting_org_ref"/>
                <field column="type_id" name="reporting_org_type"/>
                <field column="secondary_reporter" name="reporting_org_secondary_reporter"/>
                <entity name="activity_reporting_org_narrative" 
                    query="
                        SELECT 
                            primary_name 
                        FROM iati_organisation_organisation 
                        WHERE iati_organisation_organisation.id=${activity_reporting_org.organisation_id}
                    "
                >
                    <field column="primary_name" name="reporting_org_narrative"/>
                </entity> 
            </entity>
            <entity name="activity_result_title" 
                query="
                    SELECT
                        id,
                        CAST((
                            SELECT
                                JSON_AGG(ROW_TO_JSON(title_records)) as title
                            FROM (
                                SELECT
                                       language_id AS lang,
                                       content AS narrative
                                FROM iati_narrative, django_content_type
                                WHERE related_object_id = iati_resulttitle.id
                                    AND django_content_type.model = 'resulttitle'
                                    AND related_content_type_id = django_content_type.id
                                ) as title_records
                        ) AS VARCHAR)
                    FROM iati_resulttitle
                    WHERE result_id=${activity_result.id}
                "
            >
                <field column="title" name="result_title"/>
                <entity name="activity_result_title_narrative" 
                    query="
                        SELECT 
                            iati_narrative.related_object_id AS related_object_id, 
                            iati_narrative.content AS content 
                        FROM iati_narrative, django_content_type 
                        WHERE iati_narrative.related_object_id=${activity_result_title.id} 
                            AND iati_narrative.activity_id=${activity_result.activity_id} 
                            AND django_content_type.model='resulttitle' 
                            AND django_content_type.id=iati_narrative.related_content_type_id
                    "
                >
                    <field column="content" name="result_title_narrative"/>
                </entity>
            </entity>
            <entity name="activity_result_description" 
                query="
                    SELECT
                        id,
                        CAST((
                            SELECT
                                JSON_AGG(ROW_TO_JSON(description_records)) as description
                            FROM (
                                SELECT
                                       language_id AS lang,
                                       content AS narrative
                                FROM iati_narrative, django_content_type
                                WHERE related_object_id = iati_resultdescription.id
                                    AND django_content_type.model = 'resultdescription'
                                    AND related_content_type_id = django_content_type.id
                                ) as description_records
                        ) AS VARCHAR)
                    FROM iati_resultdescription
                    WHERE result_id=${activity_result.id}
                "
            >
                <field column="description" name="result_description"/>
                <entity name="activity_result_title_narrative" 
                    query="
                        SELECT 
                            iati_narrative.related_object_id AS related_object_id, 
                            iati_narrative.content AS content 
                        FROM iati_narrative, django_content_type 
                        WHERE iati_narrative.related_object_id=${activity_result_description.id} 
                            AND iati_narrative.activity_id=${activity_result.activity_id} 
                            AND django_content_type.model='resultdescription' 
                            AND django_content_type.id=iati_narrative.related_content_type_id
                    "
                >
                    <field column="content" name="result_description_narrative"/>
                </entity>
            </entity>
            <entity name="activity_result_document_link"
                query="
                    SELECT
                        id,
                        url,
                        file_format_id,
                        TO_CHAR(iso_date::timestamp, 'YYYY-MM-DD') AS iso_date,
                        CAST((
                            SELECT
                                JSON_AGG(ROW_TO_JSON(document_link_records)) as document_link
                            FROM (
                                SELECT
                                    url AS url,
                                    file_format_id AS format,
                                    (
                                        SELECT
                                            ROW_TO_JSON(title_record) AS title
                                        FROM (
                                            SELECT
                                                JSON_AGG(ROW_TO_JSON(narrative_records)) AS narrative
                                            FROM (
                                                     SELECT language_id AS lang,
                                                            content     AS text
                                                     FROM iati_documentlinktitle,
                                                          iati_narrative,
                                                          django_content_type
                                                     WHERE iati_documentlinktitle.document_link_id = iati_documentlink.id
                                                       AND iati_narrative.related_object_id = iati_documentlinktitle.id
                                                       AND iati_narrative.activity_id = iati_documentlink.activity_id
                                                       AND django_content_type.model = 'documentlinktitle'
                                                       AND django_content_type.id = iati_narrative.related_content_type_id
                                            ) AS narrative_records
                                        ) AS title_record
                                    ),
                                    (
                                        SELECT
                                            ROW_TO_JSON(description_record) AS description
                                        FROM (
                                            SELECT
                                                JSON_AGG(ROW_TO_JSON(narrative_records)) AS narrative
                                            FROM (
                                                     SELECT language_id AS lang,
                                                            content     AS text
                                                     FROM iati_documentlinkdescription,
                                                          iati_narrative,
                                                          django_content_type
                                                     WHERE iati_documentlinkdescription.document_link_id = iati_documentlink.id
                                                       AND iati_narrative.related_object_id = iati_documentlinkdescription.id
                                                       AND iati_narrative.activity_id = iati_documentlink.activity_id
                                                       AND django_content_type.model = 'documentlinkdescription'
                                                       AND django_content_type.id = iati_narrative.related_content_type_id
                                            ) AS narrative_records
                                        ) AS description_record
                                    ),
                                    (
                                        SELECT
                                            JSON_AGG(ROW_TO_JSON(category_records)) AS category
                                        FROM (
                                            SELECT
                                                   category_id AS code
                                            FROM iati_documentlinkcategory
                                            WHERE document_link_id = iati_documentlink.id
                                        ) AS category_records
                                    ),
                                    (
                                        SELECT
                                            JSON_AGG(ROW_TO_JSON(language_records)) AS language
                                        FROM (
                                            SELECT
                                                   language_id AS code
                                            FROM iati_documentlinklanguage
                                            WHERE document_link_id = iati_documentlink.id
                                        ) AS language_records
                                    ),
                                    (
                                        SELECT
                                            ROW_TO_JSON(document_date_record) AS document_date
                                        FROM (
                                            SELECT
                                                   TO_CHAR(iso_date::timestamp, 'YYYY-MM-DD') AS iso_date
                                        ) AS document_date_record
                                    )
                                ) AS document_link_records
                        ) AS VARCHAR)
                    FROM iati_documentlink
                    WHERE result_id=${activity_result.id}
                        AND activity_id=${activity_result.activity_id}
                "
            >
                <field column="document_link" name="result_document_link"/>
                <field column="url" name="result_document_link_url"/>
                <field column="file_format_id" name="result_document_link_format"/>
                <field column="iso_date" name="result_document_link_document_date_iso_date"/>
                <entity name="result_document_link_title" 
                    query="
                        SELECT
                            id
                        FROM iati_documentlinktitle
                        WHERE document_link_id=${activity_result_document_link.id}
                    "
                >
                    <entity name="result_document_link_title_narrative"
                        query="
                            SELECT 
                                iati_narrative.related_object_id AS related_object_id, 
                                iati_narrative.content AS content 
                            FROM iati_narrative, django_content_type 
                            WHERE iati_narrative.related_object_id=${result_document_link_title.id} 
                                AND iati_narrative.activity_id=${activity_result.activity_id} 
                                AND django_content_type.model='documentlinktitle' 
                                AND django_content_type.id=iati_narrative.related_content_type_id
                        "
                    >
                        <field column="content" name="result_document_link_title_narrative"/>
                    </entity>
                </entity>
                <entity name="result_document_link_description" 
                    query="
                        SELECT
                            id  
                        FROM iati_documentlinkdescription 
                        WHERE document_link_id=${activity_result_document_link.id}
                    "
                >
                    <entity name="aesult_document_link_description_narrative" 
                        query="
                            SELECT 
                                iati_narrative.related_object_id AS related_object_id, 
                                iati_narrative.content AS content 
                            FROM iati_narrative, django_content_type 
                            WHERE iati_narrative.related_object_id=${result_document_link_description.id} 
                                AND iati_narrative.activity_id=${activity_result.activity_id} 
                                AND django_content_type.model='documentlinkdescription' 
                                AND django_content_type.id=iati_narrative.related_content_type_id
                        "
                    >
                        <field column="content" name="result_document_link_description_narrative"/>
                    </entity>
                </entity>
                <entity name="result_document_link_category" 
                    query="
                        SELECT
                            category_id  
                        FROM iati_documentlinkcategory 
                        WHERE document_link_id=${activity_result_document_link.id}
                    "
                >
                    <field column="category_id" name="result_document_link_category_code"/>
                </entity>
                <entity name="result_document_link_language" 
                    query="
                        SELECT
                            language_id  
                        FROM iati_documentlinklanguage 
                        WHERE document_link_id=${activity_result_document_link.id}
                    "
                >
                    <field column="language_id" name="result_document_link_language_code"/>
                </entity>
            </entity> 
            <entity name="activity_result_reference" 
                query="
                    SELECT
                        vocabulary_id,
                        iati_resultreference.code AS code,
                        vocabulary_uri,
                        CAST((
                            SELECT ROW_TO_JSON(resultreference_record) AS result_reference FROM
                            (
                                SELECT
                                    iati_resultreference.code AS code,
                                    vocabulary_uri,
                                    (
                                        SELECT
                                             ROW_TO_JSON(iati_vocabulary_resultvocabulary_record) AS vocabulary
                                        FROM (
                                            SELECT
                                                   iati_vocabulary_resultvocabulary.code AS code,
                                                    iati_vocabulary_resultvocabulary.name AS name
                                        ) iati_vocabulary_resultvocabulary_record
                                    )
                            ) resultreference_record
                        ) AS VARCHAR)
                    FROM iati_resultreference, iati_vocabulary_resultvocabulary
                    WHERE result_id=${activity_result.id}
                        AND iati_resultreference.vocabulary_id = iati_vocabulary_resultvocabulary.code
                "
            >
                <field column="result_reference" name="result_reference"/>
                <field column="vocabulary_id" name="result_reference_vocabulary"/>
                <field column="code" name="result_reference_code"/>
                <field column="vocabulary_uri" name="result_reference_vocabulary_uri"/>
            </entity>
            <entity name="activity_result_indicator" 
                query="
                    SELECT
                        iati_resultindicator.id AS id,
                        iati_resultindicator.measure_id AS measure_id,
                        CASE WHEN iati_resultindicator.ascending=TRUE THEN '1' ELSE '0' END AS ascending,
                        CASE WHEN iati_resultindicator.aggregation_status=TRUE THEN '1' ELSE '0' END AS aggregation_status,
                        CAST((
                            SELECT
                                JSON_AGG(ROW_TO_JSON(indicator_records)) as indicator
                            FROM (
                                SELECT
                                    iati_resultindicator.measure_id AS measure,
                                    CASE WHEN iati_resultindicator.ascending=TRUE THEN '1' ELSE '0' END AS ascending,
                                    CASE WHEN iati_resultindicator.aggregation_status=TRUE THEN '1' ELSE '0' END AS aggregation_status,
                                    (
                                        SELECT
                                            ROW_TO_JSON(title_record) AS title
                                        FROM (
                                            SELECT
                                                JSON_AGG(ROW_TO_JSON(narrative_records)) AS narrative
                                            FROM (
                                                     SELECT language_id AS lang,
                                                            content     AS text
                                                     FROM iati_resultindicatortitle,
                                                          iati_narrative,
                                                          django_content_type
                                                     WHERE iati_resultindicatortitle.result_indicator_id = iati_resultindicator.id
                                                       AND iati_narrative.related_object_id = iati_resultindicatortitle.id
                                                       AND iati_narrative.activity_id = iati_result.activity_id
                                                       AND django_content_type.model = 'resultindicatortitle'
                                                       AND django_content_type.id = iati_narrative.related_content_type_id
                                            ) AS narrative_records
                                        ) AS title_record
                                    ),
                                    (
                                        SELECT
                                            ROW_TO_JSON(description_record) AS description
                                        FROM (
                                            SELECT
                                                JSON_AGG(ROW_TO_JSON(narrative_records)) AS narrative
                                            FROM (
                                                     SELECT language_id AS lang,
                                                            content     AS text
                                                     FROM iati_resultindicatordescription,
                                                          iati_narrative,
                                                          django_content_type
                                                     WHERE iati_resultindicatordescription.result_indicator_id = iati_resultindicator.id
                                                       AND iati_narrative.related_object_id = iati_resultindicatordescription.id
                                                       AND iati_narrative.activity_id = iati_result.activity_id
                                                       AND django_content_type.model = 'resultindicatordescription'
                                                       AND django_content_type.id = iati_narrative.related_content_type_id
                                            ) AS narrative_records
                                        ) AS description_record
                                    ),
                                    (
                                        SELECT
                                            JSON_AGG(ROW_TO_JSON(document_link_records)) AS document_link
                                        FROM (
                                            SELECT
                                                url AS url,
                                                file_format_id AS format,
                                                (
                                                    SELECT
                                                        ROW_TO_JSON(title_record) AS title
                                                    FROM (
                                                        SELECT
                                                            JSON_AGG(ROW_TO_JSON(narrative_records)) AS narrative
                                                        FROM (
                                                                 SELECT language_id AS lang,
                                                                        content     AS text
                                                                 FROM iati_documentlinktitle,
                                                                      iati_narrative,
                                                                      django_content_type
                                                                 WHERE iati_documentlinktitle.document_link_id = iati_documentlink.id
                                                                   AND iati_narrative.related_object_id = iati_documentlinktitle.id
                                                                   AND iati_narrative.activity_id = iati_documentlink.activity_id
                                                                   AND django_content_type.model = 'documentlinktitle'
                                                                   AND django_content_type.id = iati_narrative.related_content_type_id
                                                        ) AS narrative_records
                                                    ) AS title_record
                                                ),
                                                (
                                                    SELECT
                                                        ROW_TO_JSON(description_record) AS description
                                                    FROM (
                                                        SELECT
                                                            JSON_AGG(ROW_TO_JSON(narrative_records)) AS narrative
                                                        FROM (
                                                                 SELECT language_id AS lang,
                                                                        content     AS text
                                                                 FROM iati_documentlinkdescription,
                                                                      iati_narrative,
                                                                      django_content_type
                                                                 WHERE iati_documentlinkdescription.document_link_id = iati_documentlink.id
                                                                   AND iati_narrative.related_object_id = iati_documentlinkdescription.id
                                                                   AND iati_narrative.activity_id = iati_documentlink.activity_id
                                                                   AND django_content_type.model = 'documentlinkdescription'
                                                                   AND django_content_type.id = iati_narrative.related_content_type_id
                                                        ) AS narrative_records
                                                    ) AS description_record
                                                ),
                                                (
                                                    SELECT
                                                        JSON_AGG(ROW_TO_JSON(category_records)) AS category
                                                    FROM (
                                                        SELECT
                                                               category_id AS code
                                                        FROM iati_documentlinkcategory
                                                        WHERE document_link_id = iati_documentlink.id
                                                    ) AS category_records
                                                ),
                                                (
                                                    SELECT
                                                        JSON_AGG(ROW_TO_JSON(language_records)) AS language
                                                    FROM (
                                                        SELECT
                                                               language_id AS code
                                                        FROM iati_documentlinklanguage
                                                        WHERE document_link_id = iati_documentlink.id
                                                    ) AS language_records
                                                ),
                                                (
                                                    SELECT
                                                        ROW_TO_JSON(document_date_record) AS document_date
                                                    FROM (
                                                        SELECT
                                                               TO_CHAR(iso_date::timestamp, 'YYYY-MM-DD') AS iso_date
                                                    ) AS document_date_record
                                                )
                                            FROM iati_documentlink
                                            WHERE iati_documentlink.result_indicator_id = iati_resultindicator.id
                                        ) AS document_link_records
                                    ),
                                    (
                                        SELECT
                                            JSON_AGG(ROW_TO_JSON(reference_records)) AS reference
                                        FROM (
                                            SELECT
                                                vocabulary_id AS vocabulary,
                                                code AS code
                                            FROM iati_resultindicatorreference
                                            WHERE iati_resultindicatorreference.result_indicator_id = iati_resultindicator.id

                                        ) AS reference_records
                                    ),
                                    (
                                        SELECT
                                            JSON_AGG(ROW_TO_JSON(baseline_records)) AS baseline
                                        FROM (
                                            SELECT
                                                TO_CHAR(iso_date::timestamp, 'YYYY-MM-DD') AS iso_date,
                                                year AS year,
                                                value AS value,
                                                (
                                                    SELECT
                                                        JSON_AGG(ROW_TO_JSON(location_records)) AS location
                                                    FROM (
                                                        SELECT
                                                            ref AS ref
                                                        FROM iati_location
                                                        WHERE result_indicator_baseline_id = iati_resultindicatorbaseline.id
                                                    ) AS location_records
                                                ),
                                                (
                                                    SELECT
                                                        JSON_AGG(ROW_TO_JSON(dimension_records)) AS dimension
                                                    FROM (
                                                        SELECT
                                                            name AS name,
                                                            value AS value
                                                        FROM iati_resultindicatorbaselinedimension
                                                        WHERE result_indicator_baseline_id = iati_resultindicatorbaseline.id
                                                    ) AS dimension_records
                                                ),
                                                (
                                                    SELECT
                                                        JSON_AGG(ROW_TO_JSON(document_link_records)) AS document_link
                                                    FROM (
                                                        SELECT
                                                            url AS url,
                                                            file_format_id AS format,
                                                            (
                                                                SELECT
                                                                    ROW_TO_JSON(title_record) AS title
                                                                FROM (
                                                                    SELECT
                                                                        JSON_AGG(ROW_TO_JSON(narrative_records)) AS narrative
                                                                    FROM (
                                                                             SELECT language_id AS lang,
                                                                                    content     AS text
                                                                             FROM iati_documentlinktitle,
                                                                                  iati_narrative,
                                                                                  django_content_type
                                                                             WHERE iati_documentlinktitle.document_link_id = iati_documentlink.id
                                                                               AND iati_narrative.related_object_id = iati_documentlinktitle.id
                                                                               AND iati_narrative.activity_id = iati_documentlink.activity_id
                                                                               AND django_content_type.model = 'documentlinktitle'
                                                                               AND django_content_type.id = iati_narrative.related_content_type_id
                                                                    ) AS narrative_records
                                                                ) AS title_record
                                                            ),
                                                            (
                                                                SELECT
                                                                    ROW_TO_JSON(description_record) AS description
                                                                FROM (
                                                                    SELECT
                                                                        JSON_AGG(ROW_TO_JSON(narrative_records)) AS narrative
                                                                    FROM (
                                                                             SELECT language_id AS lang,
                                                                                    content     AS text
                                                                             FROM iati_documentlinkdescription,
                                                                                  iati_narrative,
                                                                                  django_content_type
                                                                             WHERE iati_documentlinkdescription.document_link_id = iati_documentlink.id
                                                                               AND iati_narrative.related_object_id = iati_documentlinkdescription.id
                                                                               AND iati_narrative.activity_id = iati_documentlink.activity_id
                                                                               AND django_content_type.model = 'documentlinkdescription'
                                                                               AND django_content_type.id = iati_narrative.related_content_type_id
                                                                    ) AS narrative_records
                                                                ) AS description_record
                                                            ),
                                                            (
                                                                SELECT
                                                                    JSON_AGG(ROW_TO_JSON(category_records)) AS category
                                                                FROM (
                                                                    SELECT
                                                                           category_id AS code
                                                                    FROM iati_documentlinkcategory
                                                                    WHERE document_link_id = iati_documentlink.id
                                                                ) AS category_records
                                                            ),
                                                            (
                                                                SELECT
                                                                    JSON_AGG(ROW_TO_JSON(language_records)) AS language
                                                                FROM (
                                                                    SELECT
                                                                           language_id AS code
                                                                    FROM iati_documentlinklanguage
                                                                    WHERE document_link_id = iati_documentlink.id
                                                                ) AS language_records
                                                            ),
                                                            (
                                                                SELECT
                                                                    ROW_TO_JSON(document_date_record) AS document_date
                                                                FROM (
                                                                    SELECT
                                                                           TO_CHAR(iso_date::timestamp, 'YYYY-MM-DD') AS iso_date
                                                                ) AS document_date_record
                                                            )
                                                        FROM iati_documentlink
                                                        WHERE iati_documentlink.result_indicator_baseline_id = iati_resultindicatorbaseline.id
                                                    ) AS document_link_records
                                                ),
                                                (
                                                    SELECT
                                                        ROW_TO_JSON(comment_record) AS comment
                                                    FROM (
                                                        SELECT
                                                            JSON_AGG(ROW_TO_JSON(narrative_records)) AS narrative
                                                        FROM (
                                                            SELECT
                                                                language_id AS lang,
                                                                content     AS text
                                                            FROM iati_resultindicatorbaselinecomment, iati_narrative, django_content_type
                                                            WHERE iati_resultindicatorbaselinecomment.result_indicator_baseline_id = iati_resultindicatorbaseline.id
                                                                AND iati_narrative.related_object_id = iati_resultindicatorbaselinecomment.id
                                                                AND iati_narrative.activity_id = iati_result.activity_id
                                                                AND django_content_type.model = 'resultindicatorbaselinecomment'
                                                                AND django_content_type.id = iati_narrative.related_content_type_id
                                                        ) AS narrative_records
                                                    ) AS comment_record
                                                )
                                            FROM iati_resultindicatorbaseline
                                            WHERE iati_resultindicatorbaseline.result_indicator_id = iati_resultindicator.id
                                        ) AS baseline_records
                                    ),
                                    (
                                        SELECT
                                            JSON_AGG(ROW_TO_JSON(period_records)) AS period
                                        FROM (
                                            SELECT
                                                (
                                                    SELECT
                                                        ROW_TO_JSON(period_start_record) AS period_start
                                                    FROM (
                                                         SELECT
                                                            TO_CHAR(period_start::timestamp, 'YYYY-MM-DD') AS iso_date
                                                    ) AS period_start_record
                                                ),
                                                (
                                                    SELECT
                                                        ROW_TO_JSON(period_end_record) AS period_end
                                                    FROM (
                                                         SELECT
                                                            TO_CHAR(period_end::timestamp, 'YYYY-MM-DD') AS iso_date
                                                    ) AS period_end_record
                                                ),
                                                (
                                                    SELECT
                                                        JSON_AGG(ROW_TO_JSON(target_records)) AS target
                                                    FROM (
                                                        SELECT
                                                            iati_resultindicatorperiodtarget.value AS value,
                                                            (
                                                                SELECT
                                                                    JSON_AGG(ROW_TO_JSON(location_records)) AS location
                                                                FROM (
                                                                    SELECT
                                                                        ref AS ref
                                                                    FROM iati_resultindicatorperiodactuallocation
                                                                    WHERE result_indicator_period_actual_id = iati_resultindicatorperiodtarget.id
                                                                ) AS location_records
                                                            ),
                                                            (
                                                                SELECT
                                                                    JSON_AGG(ROW_TO_JSON(dimension_records)) AS dimension
                                                                FROM (
                                                                    SELECT
                                                                        name AS name,
                                                                        value AS value
                                                                    FROM iati_resultindicatorperiodactualdimension
                                                                        WHERE result_indicator_period_actual_id = iati_resultindicatorperiodtarget.id
                                                                ) AS dimension_records
                                                            ),
                                                            (
                                                                SELECT
                                                                    ROW_TO_JSON(comment_record) AS comment
                                                                FROM (
                                                                    SELECT
                                                                        JSON_AGG(ROW_TO_JSON(narrative_records)) AS narrative
                                                                    FROM (
                                                                        SELECT
                                                                            language_id AS lang,
                                                                            content     AS text
                                                                        FROM iati_resultindicatorperiodtargetcomment, iati_narrative, django_content_type
                                                                        WHERE iati_resultindicatorperiodtargetcomment.result_indicator_period_target_id = iati_resultindicatorperiodtarget.id
                                                                            AND iati_narrative.related_object_id = iati_resultindicatorperiodtargetcomment.id
                                                                            AND iati_narrative.activity_id = iati_result.activity_id
                                                                            AND django_content_type.model = 'resultindicatorperiodactualcomment'
                                                                            AND django_content_type.id = iati_narrative.related_content_type_id
                                                                        ) AS narrative_records
                                                                ) AS comment_record
                                                            ),
                                                            (
                                                                SELECT
                                                                    JSON_AGG(ROW_TO_JSON(document_link_records)) AS document_link
                                                                FROM (
                                                                    SELECT
                                                                        url AS url,
                                                                        file_format_id AS format,
                                                                        (
                                                                            SELECT
                                                                                ROW_TO_JSON(title_record) AS title
                                                                            FROM (
                                                                                SELECT
                                                                                    JSON_AGG(ROW_TO_JSON(narrative_records)) AS narrative
                                                                                FROM (
                                                                                    SELECT
                                                                                        language_id AS lang,
                                                                                        content     AS text
                                                                                    FROM iati_documentlinktitle, iati_narrative, django_content_type
                                                                                    WHERE iati_documentlinktitle.document_link_id = iati_documentlink.id
                                                                                        AND iati_narrative.related_object_id = iati_documentlinktitle.id
                                                                                        AND iati_narrative.activity_id = iati_documentlink.activity_id
                                                                                        AND django_content_type.model = 'documentlinktitle'
                                                                                        AND django_content_type.id = iati_narrative.related_content_type_id
                                                                                ) AS narrative_records
                                                                            ) AS title_record
                                                                        ),
                                                                        (
                                                                            SELECT
                                                                                ROW_TO_JSON(description_record) AS description
                                                                            FROM (
                                                                                SELECT
                                                                                    JSON_AGG(ROW_TO_JSON(narrative_records)) AS narrative
                                                                                FROM (
                                                                                    SELECT
                                                                                        language_id AS lang,
                                                                                        content     AS text
                                                                                    FROM iati_documentlinkdescription, iati_narrative, django_content_type
                                                                                    WHERE iati_documentlinkdescription.document_link_id = iati_documentlink.id
                                                                                        AND iati_narrative.related_object_id = iati_documentlinkdescription.id
                                                                                        AND iati_narrative.activity_id = iati_documentlink.activity_id
                                                                                        AND django_content_type.model = 'documentlinkdescription'
                                                                                        AND django_content_type.id = iati_narrative.related_content_type_id
                                                                                ) AS narrative_records
                                                                            ) AS description_record
                                                                        ),
                                                                        (
                                                                            SELECT
                                                                                JSON_AGG(ROW_TO_JSON(category_records)) AS category
                                                                            FROM (
                                                                                SELECT
                                                                                    category_id AS code
                                                                                FROM iati_documentlinkcategory
                                                                                WHERE document_link_id = iati_documentlink.id
                                                                            ) AS category_records
                                                                        ),
                                                                        (
                                                                            SELECT
                                                                                JSON_AGG(ROW_TO_JSON(language_records)) AS language
                                                                            FROM (
                                                                                SELECT
                                                                                    language_id AS code
                                                                                FROM iati_documentlinklanguage
                                                                                WHERE document_link_id = iati_documentlink.id
                                                                            ) AS language_records
                                                                        ),
                                                                        (
                                                                            SELECT
                                                                                ROW_TO_JSON(document_date_record) AS document_date
                                                                            FROM (
                                                                                SELECT
                                                                                    TO_CHAR(iso_date::timestamp, 'YYYY-MM-DD') AS iso_date
                                                                            ) AS document_date_record
                                                                        )
                                                                    FROM iati_documentlink
                                                                    WHERE iati_documentlink.result_indicator_period_target_id = iati_resultindicatorperiodtarget.id
                                                                ) AS document_link_records
                                                            )
                                                        FROM iati_resultindicatorperiodtarget
                                                        WHERE iati_resultindicatorperiodtarget.result_indicator_period_id = iati_resultindicatorperiod.id
                                                    ) AS target_records
                                                ),
                                                (
                                                    SELECT
                                                        JSON_AGG(ROW_TO_JSON(actual_records)) AS actual
                                                    FROM (
                                                        SELECT
                                                            iati_resultindicatorperiodactual.value AS value,
                                                            (
                                                                SELECT
                                                                    JSON_AGG(ROW_TO_JSON(location_records)) AS location
                                                                FROM (
                                                                    SELECT
                                                                        ref AS ref
                                                                    FROM iati_resultindicatorperiodactuallocation
                                                                    WHERE result_indicator_period_actual_id = iati_resultindicatorperiodactual.id
                                                                ) AS location_records
                                                            ),
                                                            (
                                                                SELECT
                                                                    JSON_AGG(ROW_TO_JSON(dimension_records)) AS dimension
                                                                FROM (
                                                                    SELECT
                                                                        name AS name,
                                                                        value AS value
                                                                    FROM iati_resultindicatorperiodactualdimension
                                                                        WHERE result_indicator_period_actual_id = iati_resultindicatorperiodactual.id
                                                                ) AS dimension_records
                                                            ),
                                                            (
                                                                SELECT
                                                                    ROW_TO_JSON(comment_record) AS comment
                                                                FROM (
                                                                    SELECT
                                                                        JSON_AGG(ROW_TO_JSON(narrative_records)) AS narrative
                                                                    FROM (
                                                                        SELECT
                                                                            language_id AS lang,
                                                                            content     AS text
                                                                        FROM iati_resultindicatorperiodactualcomment, iati_narrative, django_content_type
                                                                        WHERE iati_resultindicatorperiodactualcomment.result_indicator_period_actual_id = iati_resultindicatorperiodactual.id
                                                                            AND iati_narrative.related_object_id = iati_resultindicatorperiodactualcomment.id
                                                                            AND iati_narrative.activity_id = iati_result.activity_id
                                                                            AND django_content_type.model = 'resultindicatorperiodactualcomment'
                                                                            AND django_content_type.id = iati_narrative.related_content_type_id
                                                                        ) AS narrative_records
                                                                ) AS comment_record
                                                            ),
                                                            (
                                                                SELECT
                                                                    JSON_AGG(ROW_TO_JSON(document_link_records)) AS document_link
                                                                FROM (
                                                                    SELECT
                                                                        url AS url,
                                                                        file_format_id AS format,
                                                                        (
                                                                            SELECT
                                                                                ROW_TO_JSON(title_record) AS title
                                                                            FROM (
                                                                                SELECT
                                                                                    JSON_AGG(ROW_TO_JSON(narrative_records)) AS narrative
                                                                                FROM (
                                                                                    SELECT
                                                                                        language_id AS lang,
                                                                                        content     AS text
                                                                                    FROM iati_documentlinktitle, iati_narrative, django_content_type
                                                                                    WHERE iati_documentlinktitle.document_link_id = iati_documentlink.id
                                                                                        AND iati_narrative.related_object_id = iati_documentlinktitle.id
                                                                                        AND iati_narrative.activity_id = iati_documentlink.activity_id
                                                                                        AND django_content_type.model = 'documentlinktitle'
                                                                                        AND django_content_type.id = iati_narrative.related_content_type_id
                                                                                ) AS narrative_records
                                                                            ) AS title_record
                                                                        ),
                                                                        (
                                                                            SELECT
                                                                                ROW_TO_JSON(description_record) AS description
                                                                            FROM (
                                                                                SELECT
                                                                                    JSON_AGG(ROW_TO_JSON(narrative_records)) AS narrative
                                                                                FROM (
                                                                                    SELECT
                                                                                        language_id AS lang,
                                                                                        content     AS text
                                                                                    FROM iati_documentlinkdescription, iati_narrative, django_content_type
                                                                                    WHERE iati_documentlinkdescription.document_link_id = iati_documentlink.id
                                                                                        AND iati_narrative.related_object_id = iati_documentlinkdescription.id
                                                                                        AND iati_narrative.activity_id = iati_documentlink.activity_id
                                                                                        AND django_content_type.model = 'documentlinkdescription'
                                                                                        AND django_content_type.id = iati_narrative.related_content_type_id
                                                                                ) AS narrative_records
                                                                            ) AS description_record
                                                                        ),
                                                                        (
                                                                            SELECT
                                                                                JSON_AGG(ROW_TO_JSON(category_records)) AS category
                                                                            FROM (
                                                                                SELECT
                                                                                    category_id AS code
                                                                                FROM iati_documentlinkcategory
                                                                                WHERE document_link_id = iati_documentlink.id
                                                                            ) AS category_records
                                                                        ),
                                                                        (
                                                                            SELECT
                                                                                JSON_AGG(ROW_TO_JSON(language_records)) AS language
                                                                            FROM (
                                                                                SELECT
                                                                                    language_id AS code
                                                                                FROM iati_documentlinklanguage
                                                                                WHERE document_link_id = iati_documentlink.id
                                                                            ) AS language_records
                                                                        ),
                                                                        (
                                                                            SELECT
                                                                                ROW_TO_JSON(document_date_record) AS document_date
                                                                            FROM (
                                                                                SELECT
                                                                                    TO_CHAR(iso_date::timestamp, 'YYYY-MM-DD') AS iso_date
                                                                            ) AS document_date_record
                                                                        )
                                                                    FROM iati_documentlink
                                                                    WHERE iati_documentlink.result_indicator_period_actual_id = iati_resultindicatorperiodactual.id
                                                                ) AS document_link_records
                                                            )
                                                        FROM iati_resultindicatorperiodactual
                                                        WHERE iati_resultindicatorperiodactual.result_indicator_period_id = iati_resultindicatorperiod.id
                                                    ) AS actual_records
                                                )
                                            FROM iati_resultindicatorperiod
                                            WHERE iati_resultindicatorperiod.result_indicator_id = iati_resultindicator.id
                                        ) AS period_records
                                    )
                                ) AS indicator_records
                        ) AS VARCHAR)
                    FROM iati_resultindicator, iati_result
                    WHERE iati_result.id = ${activity_result.id}
                        AND iati_resultindicator.result_id = iati_result.id
                "
            >
                <field column="indicator" name="result_indicator"/>
                <field column="measure_id" name="result_indicator_measure"/>
                <field column="ascending" name="result_indicator_acsending"/>
                <field column="aggregation_status" name="result_indicator_aggregation_status"/>
                <entity name="activity_result_indicator_title" 
                    query="
                        SELECT
                            id  
                        FROM iati_resultindicatortitle 
                        WHERE result_indicator_id=${activity_result_indicator.id}
                    "
                >
                    <entity name="aesult_document_link_title_narrative" 
                        query="
                            SELECT 
                                iati_narrative.related_object_id AS related_object_id, 
                                iati_narrative.content AS content 
                            FROM iati_narrative, django_content_type 
                            WHERE iati_narrative.related_object_id=${activity_result_indicator_title.id} 
                                AND iati_narrative.activity_id=${activity_result.activity_id} 
                                AND django_content_type.model='resultindicatortitle' 
                                AND django_content_type.id=iati_narrative.related_content_type_id
                        "
                    >
                        <field column="content" name="result_indicator_title_narrative"/>
                    </entity>
                </entity>
                <entity name="activity_result_indicator_description" 
                    query="
                        SELECT
                            id  
                        FROM iati_resultindicatordescription 
                        WHERE result_indicator_id=${activity_result_indicator.id}
                    "
                >
                    <entity name="activity_result_indicator_description_narrative" 
                        query="
                            SELECT 
                                iati_narrative.related_object_id AS related_object_id, 
                                iati_narrative.content AS content 
                            FROM iati_narrative, django_content_type 
                            WHERE iati_narrative.related_object_id=${activity_result_indicator_description.id} 
                                AND iati_narrative.activity_id=${activity_result.activity_id} 
                                AND django_content_type.model='resultindicatordescription' 
                                AND django_content_type.id=iati_narrative.related_content_type_id
                        "
                    >
                        <field column="content" name="result_indicator_description_narrative"/>
                    </entity>
                </entity>
                <entity name="activity_result_indicator_document_link"
                    query="
                        SELECT
                            id,
                            url,
                            file_format_id,
                            TO_CHAR(iso_date::timestamp, 'YYYY-MM-DD') AS iso_date
                        FROM iati_documentlink 
                        WHERE result_indicator_id=${activity_result_indicator.id}
                            AND activity_id=${activity_result.activity_id}
                    "
                >
                    <field column="url" name="result_indicator_document_link_url"/>
                    <field column="file_format_id" name="result_indicator_document_link_format"/>
                    <field column="iso_date" name="result_indicator_document_link_document_date_iso_date"/>
                    <entity name="activity_result_indicator_document_link_title" 
                        query="
                            SELECT
                                id  
                            FROM iati_documentlinktitle 
                            WHERE document_link_id=${activity_result_indicator_document_link.id}
                        "
                    >
                        <entity name="activity_result_indicator_document_link_title_narrative" 
                            query="
                                SELECT 
                                    iati_narrative.related_object_id AS related_object_id, 
                                    iati_narrative.content AS content 
                                FROM iati_narrative, django_content_type 
                                WHERE iati_narrative.related_object_id=${activity_result_indicator_document_link_title.id} 
                                    AND iati_narrative.activity_id=${activity_result.activity_id} 
                                    AND django_content_type.model='documentlinktitle' 
                                    AND django_content_type.id=iati_narrative.related_content_type_id
                            "
                        >
                            <field column="content" name="result_indicator_document_link_title_narrative"/>
                        </entity>
                    </entity>
                    <entity name="activity_result_indicator_document_link_description" 
                        query="
                            SELECT
                                id  
                            FROM iati_documentlinkdescription 
                            WHERE document_link_id=${activity_result_indicator_document_link.id}
                        "
                    >
                        <entity name="activity_result_indicator_document_link_description_narrative" 
                            query="
                                SELECT 
                                    iati_narrative.related_object_id AS related_object_id, 
                                    iati_narrative.content AS content 
                                FROM iati_narrative, django_content_type 
                                WHERE iati_narrative.related_object_id=${activity_result_indicator_document_link_description.id} 
                                    AND iati_narrative.activity_id=${activity_result.activity_id} 
                                    AND django_content_type.model='documentlinkdescription' 
                                    AND django_content_type.id=iati_narrative.related_content_type_id
                            "
                        >
                            <field column="content" name="result_indicator_document_link_description_narrative"/>
                        </entity>
                    </entity>
                    <entity name="activity_result_indicator_document_link_category" 
                        query="
                            SELECT
                                category_id  
                            FROM iati_documentlinkcategory 
                            WHERE document_link_id=${activity_result_indicator_document_link.id}
                        "
                    >
                        <field column="category_id" name="result_indicator_document_link_category_code"/>
                    </entity>
                    <entity name="activity_result_indicator_document_link_language" 
                        query="
                            SELECT
                                language_id  
                            FROM iati_documentlinklanguage 
                            WHERE document_link_id=${activity_result_indicator_document_link.id}
                        "
                    >
                        <field column="language_id" name="result_indicator_document_link_language_code"/>
                    </entity>
                </entity> 
                <entity name="activity_result_indicator_reference" 
                    query="
                        SELECT 
                            vocabulary_id,
                            code,
                            indicator_uri
                        FROM iati_resultindicatorreference 
                        WHERE result_indicator_id=${activity_result_indicator.id}
                    "
                >
                    <field column="vocabulary_id" name="result_indicator_reference_vocabulary"/>
                    <field column="code" name="result_indicator_reference_code"/>
                    <field column="vocabulary_uri" name="result_indicator_reference_vocabulary_uri"/>
                </entity> 
                <entity name="activity_result_indicator_baseline" 
                    query="
                        SELECT 
                            id,
                            year,
                            TO_CHAR(iso_date::timestamp, 'YYYY-MM-DD') AS iso_date,
                            value
                        FROM iati_resultindicatorbaseline 
                        WHERE result_indicator_id=${activity_result_indicator.id}
                    "
                >
                    <field column="year" name="result_indicator_baseline_year"/>
                    <field column="iso_date" name="result_indicator_baseline_iso_date"/>
                    <field column="value" name="result_indicator_baseline_value"/>
                    <entity name="activity_result_indicator_baseline_location" 
                        query="
                            SELECT 
                                ref
                            FROM iati_location 
                            WHERE result_indicator_baseline_id=${activity_result_indicator_baseline.id}
                        "
                    >
                        <field column="ref" name="result_indicator_baseline_location_ref"/>
                    </entity>
                    <entity name="activity_result_indicator_baseline_dimersion" 
                        query="
                            SELECT 
                                name,
                                value
                            FROM iati_resultindicatorbaselinedimension 
                            WHERE result_indicator_baseline_id=${activity_result_indicator_baseline.id}
                        "
                    >
                        <field column="name" name="result_indicator_baseline_dimension_name"/>
                        <field column="value" name="result_indicator_baseline_dimension_value"/>
                        <entity name="activity_result_indicator_baseline_dimension_document_link"
                            query="
                                SELECT
                                    id,
                                    url,
                                    file_format_id,
                                    TO_CHAR(iso_date::timestamp, 'YYYY-MM-DD') AS iso_date
                                FROM iati_documentlink 
                                WHERE result_indicator_baseline_id=${activity_result_indicator.id}
                                    AND activity_id=${activity_result.activity_id}
                            "
                        >
                            <field column="url" name="result_indicator_baseline_document_link_url"/>
                            <field column="file_format_id" name="result_indicator_baseline_document_link_format"/>
                            <field column="iso_date" name="result_indicator_baseline_document_link_document_date_iso_date"/>
                            <entity name="activity_result_indicator_baseline_dimension_document_link_title" 
                                query="
                                    SELECT
                                        id  
                                    FROM iati_documentlinktitle 
                                    WHERE document_link_id=${activity_result_indicator_baseline_dimension_document_link.id}
                                "
                            >
                                <entity name="activity_result_indicator_baseline_dimension_document_link_title_narrative" 
                                    query="
                                        SELECT 
                                            iati_narrative.related_object_id AS related_object_id, 
                                            iati_narrative.content AS content 
                                        FROM iati_narrative, django_content_type 
                                        WHERE iati_narrative.related_object_id=${activity_result_indicator_baseline_dimension_document_link_title.id} 
                                            AND iati_narrative.activity_id=${activity_result.activity_id} 
                                            AND django_content_type.model='documentlinktitle' 
                                            AND django_content_type.id=iati_narrative.related_content_type_id
                                    "
                                >
                                    <field column="content" name="result_indicator_baseline_document_link_title"/>
                                </entity>
                            </entity>
                            <entity name="activity_result_indicator_baseline_dimension_document_link_description" 
                                query="
                                    SELECT
                                        id  
                                    FROM iati_documentlinkdescription
                                    WHERE document_link_id=${activity_result_indicator_baseline_dimension_document_link.id}
                                "
                            >
                                <entity name="activity_result_indicator_baseline_dimension_document_link_description_narrative" 
                                    query="
                                        SELECT 
                                            iati_narrative.related_object_id AS related_object_id, 
                                            iati_narrative.content AS content 
                                        FROM iati_narrative, django_content_type 
                                        WHERE iati_narrative.related_object_id=${activity_result_indicator_baseline_dimension_document_link_description.id} 
                                            AND iati_narrative.activity_id=${activity_result.activity_id} 
                                            AND django_content_type.model='documentlinkdescription' 
                                            AND django_content_type.id=iati_narrative.related_content_type_id
                                    "
                                >
                                    <field column="content" name="result_indicator_baseline_document_link_description"/>
                                </entity>
                            </entity>
                            <entity name="activity_result_indicator_baseline_dimension_document_link_category" 
                                query="
                                    SELECT
                                        category_id  
                                    FROM iati_documentlinkcategory 
                                    WHERE document_link_id=${activity_result_indicator_baseline_dimension_document_link.id}
                                "
                            >
                                <field column="category_id" name="result_indicator_baseline_document_link_category_code"/>
                            </entity>
                            <entity name="activity_result_indicator_baseline_dimension_document_link_language" 
                                query="
                                    SELECT
                                        language_id  
                                    FROM iati_documentlinklanguage 
                                    WHERE document_link_id=${activity_result_indicator_baseline_dimension_document_link.id}
                                "
                            >
                                <field column="language_id" name="result_indicator_baseline_document_link_language_code"/>
                            </entity>
                        </entity>
                        <entity name="activity_result_indicator_baseline_comment"
                            query="
                                SELECT
                                    id
                                FROM iati_resultindicatorbaselinecomment 
                                WHERE result_indicator_baseline_id=${activity_result_indicator.id}
                            "
                        >
                            <entity name="activity_result_indicator_baseline_comment_narrative" 
                                query="
                                    SELECT 
                                        iati_narrative.related_object_id AS related_object_id, 
                                        iati_narrative.content AS content 
                                    FROM iati_narrative, django_content_type 
                                    WHERE iati_narrative.related_object_id=${activity_result_indicator_baseline_comment.id} 
                                        AND iati_narrative.activity_id=${activity_result.activity_id} 
                                        AND django_content_type.model='resultindicatorbaselinecomment' 
                                        AND django_content_type.id=iati_narrative.related_content_type_id
                                "
                            >
                                <field column="content" name="result_indicator_baseline_comment_narrative"/>
                            </entity>
                        </entity>    
                    </entity>
                </entity>
                <entity name="activity_result_indicator_period" 
                    query="
                        SELECT
                            id,
                            TO_CHAR(period_start::timestamp, 'YYYY-MM-DD') AS period_start,
                            TO_CHAR(period_end::timestamp, 'YYYY-MM-DD') AS period_end  
                        FROM iati_resultindicatorperiod 
                        WHERE result_indicator_id=${activity_result_indicator.id}
                    "
                >
                    <field column="period_start" name="result_indicator_period_period_start_iso_date"/>
                    <field column="period_end" name="result_indicator_period_period_end_iso_date"/>
                    <entity name="activity_result_indicator_period_target" 
                        query="
                            SELECT
                                id,
                                value
                            FROM iati_resultindicatorperiodtarget 
                            WHERE result_indicator_period_id=${activity_result_indicator_period.id}
                        "
                    >
                        <field column="value" name="result_indicator_period_target_value"/>
                        <entity name="activity_result_indicator_period_target_location" 
                            query="
                                SELECT
                                    ref
                                FROM iati_resultindicatorperiodtargetlocation 
                                WHERE result_indicator_period_target_id=${activity_result_indicator_period_target.id}
                            "
                        >
                            <field column="ref" name="result_indicator_period_target_location_ref"/>   
                        </entity>
                        <entity name="activity_result_indicator_period_target_dimension" 
                            query="
                                SELECT
                                    name,
                                    value
                                FROM iati_resultindicatorperiodtargetdimension 
                                WHERE result_indicator_period_target_id=${activity_result_indicator_period_target.id}
                            "
                        >
                            <field column="name" name="result_indicator_period_target_dimmension_name"/> 
                            <field column="value" name="result_indicator_period_target_dimmension_value"/>   
                        </entity>
                        <entity name="activity_result_indicator_period_target_comment" 
                            query="
                                SELECT
                                    id
                                FROM iati_resultindicatorperiodtargetcomment 
                                WHERE result_indicator_period_target_id=${activity_result_indicator_period_target.id}
                            "
                        >
                            <entity name="activity_result_indicator_period_target_comment_narrative" 
                                query="
                                    SELECT 
                                        iati_narrative.related_object_id AS related_object_id, 
                                        iati_narrative.content AS content 
                                    FROM iati_narrative, django_content_type 
                                    WHERE iati_narrative.related_object_id=${activity_result_indicator_period_target_comment.id} 
                                        AND iati_narrative.activity_id=${activity_result.activity_id} 
                                        AND django_content_type.model='resultindicatorperiodtargetcomment' 
                                        AND django_content_type.id=iati_narrative.related_content_type_id
                                "
                            >
                                <field column="content" name="result_indicator_period_target_comment_narrative"/>
                            </entity>
                        </entity>
                        <entity name="activity_result_indicator_period_target_document_link"
                            query="
                                SELECT
                                    id,
                                    url,
                                    file_format_id,
                                    TO_CHAR(iso_date::timestamp, 'YYYY-MM-DD') AS iso_date
                                FROM iati_documentlink 
                                WHERE result_indicator_period_target_id=${activity_result_indicator_period_target.id}
                                    AND activity_id=${activity_result.activity_id}
                            "
                        >
                            <field column="url" name="result_indicator_period_target_document_link_url"/>
                            <field column="file_format_id" name="result_indicator_period_target_document_link_format"/>
                            <field column="iso_date" name="result_indicator_period_target_document_link_document_date_iso_date"/>
                            <entity name="activity_result_indicator_period_target_document_link_title" 
                                query="
                                    SELECT
                                        id  
                                    FROM iati_documentlinktitle 
                                    WHERE document_link_id=${activity_result_indicator_period_target_document_link.id}
                                "
                            >
                                <entity name="activity_result_indicator_period_target_document_link_title_narrative" 
                                    query="
                                        SELECT 
                                            iati_narrative.related_object_id AS related_object_id, 
                                            iati_narrative.content AS content 
                                        FROM iati_narrative, django_content_type 
                                        WHERE iati_narrative.related_object_id=${activity_result_indicator_period_target_document_link_title.id} 
                                            AND iati_narrative.activity_id=${activity_result.activity_id} 
                                            AND django_content_type.model='documentlinktitle' 
                                            AND django_content_type.id=iati_narrative.related_content_type_id
                                    "
                                >
                                    <field column="content" name="result_indicator_period_target_document_link_title_narrative"/>
                                </entity>
                            </entity>
                            <entity name="activity_result_indicator_period_target_document_link_description" 
                                query="
                                    SELECT
                                        id  
                                    FROM iati_documentlinkdescription 
                                    WHERE document_link_id=${activity_result_indicator_period_target_document_link.id}
                                "
                            >
                                <entity name="activity_result_indicator_period_target_document_link_description_narrative" 
                                    query="
                                        SELECT 
                                            iati_narrative.related_object_id AS related_object_id, 
                                            iati_narrative.content AS content 
                                        FROM iati_narrative, django_content_type 
                                        WHERE iati_narrative.related_object_id=${activity_result_indicator_period_target_document_link_description.id} 
                                            AND iati_narrative.activity_id=${activity_result.activity_id} 
                                            AND django_content_type.model='documentlinkdescription' 
                                            AND django_content_type.id=iati_narrative.related_content_type_id
                                    "
                                >
                                    <field column="content" name="result_indicator_period_target_document_link_description_narrative"/>
                                </entity>
                            </entity>
                            <entity name="activity_result_indicator_period_target_document_link_category" 
                                query="
                                    SELECT
                                        category_id  
                                    FROM iati_documentlinkcategory 
                                    WHERE document_link_id=${activity_result_indicator_period_target_document_link.id}
                                "
                            >
                                <field column="category_id" name="result_indicator_period_target_document_link_category_code"/>
                            </entity>
                            <entity name="activity_result_indicator_period_target_document_link_language" 
                                query="
                                    SELECT
                                        language_id  
                                    FROM iati_documentlinklanguage
                                    WHERE document_link_id=${activity_result_indicator_period_target_document_link.id}
                                "
                            >
                                <field column="language_id" name="result_indicator_period_target_document_link_language_code"/>
                            </entity>
                        </entity>        
                    </entity>
                    <entity name="activity_result_indicator_period_actual" 
                        query="
                            SELECT
                                id,
                                value
                            FROM iati_resultindicatorperiodactual 
                            WHERE result_indicator_period_id=${activity_result_indicator_period.id}
                        "
                    >
                        <field column="value" name="result_indicator_period_actual_value"/>
                        <entity name="activity_result_indicator_period_actual_location" 
                            query="
                                SELECT
                                    ref
                                FROM iati_resultindicatorperiodactuallocation 
                                WHERE result_indicator_period_actual_id=${activity_result_indicator_period_actual.id}
                            "
                        >
                            <field column="ref" name="result_indicator_period_actual_location_ref"/>   
                        </entity>
                        <entity name="activity_result_indicator_period_actual_dimension" 
                            query="
                                SELECT
                                    name,
                                    value
                                FROM iati_resultindicatorperiodactualdimension 
                                WHERE result_indicator_period_actual_id=${activity_result_indicator_period_actual.id}
                            "
                        >
                            <field column="name" name="result_indicator_period_actual_dimmension_name"/> 
                            <field column="value" name="result_indicator_period_actual_dimmension_value"/>   
                        </entity>
                        <entity name="activity_result_indicator_period_actual_comment" 
                            query="
                                SELECT
                                    id
                                FROM iati_resultindicatorperiodactualcomment 
                                WHERE result_indicator_period_actual_id=${activity_result_indicator_period_actual.id}
                            "
                        >
                            <entity name="activity_result_indicator_period_actual_comment_narrative" 
                                query="
                                    SELECT 
                                        iati_narrative.related_object_id AS related_object_id, 
                                        iati_narrative.content AS content 
                                    FROM iati_narrative, django_content_type 
                                    WHERE iati_narrative.related_object_id=${activity_result_indicator_period_actual_comment.id} 
                                        AND iati_narrative.activity_id=${activity_result.activity_id} 
                                        AND django_content_type.model='resultindicatorperiodactualcomment' 
                                        AND django_content_type.id=iati_narrative.related_content_type_id
                                "
                            >
                                <field column="content" name="result_indicator_period_actual_comment_narrative"/>
                            </entity>
                        </entity>
                        <entity name="activity_result_indicator_period_actual_document_link"
                            query="
                                SELECT
                                    id,
                                    url,
                                    file_format_id,
                                    TO_CHAR(iso_date::timestamp, 'YYYY-MM-DD') AS iso_date
                                FROM iati_documentlink 
                                WHERE result_indicator_period_actual_id=${activity_result_indicator_period_actual.id}
                                    AND activity_id=${activity_result.activity_id}
                            "
                        >
                            <field column="url" name="result_indicator_period_actual_document_link_url"/>
                            <field column="file_format_id" name="result_indicator_period_actual_document_link_format"/>
                            <field column="iso_date" name="result_indicator_period_actual_document_link_document_date_iso_date"/>
                            <entity name="activity_result_indicator_period_actual_document_link_title" 
                                query="
                                    SELECT
                                        id  
                                    FROM iati_documentlinktitle 
                                    WHERE document_link_id=${activity_result_indicator_period_actual_document_link.id}
                                "
                            >
                                <entity name="activity_result_indicator_period_actual_document_link_title_narrative" 
                                    query="
                                        SELECT 
                                            iati_narrative.related_object_id AS related_object_id, 
                                            iati_narrative.content AS content 
                                        FROM iati_narrative, django_content_type 
                                        WHERE iati_narrative.related_object_id=${activity_result_indicator_period_actual_document_link_title.id} 
                                            AND iati_narrative.activity_id=${activity_result.activity_id} 
                                            AND django_content_type.model='documentlinktitle' 
                                            AND django_content_type.id=iati_narrative.related_content_type_id
                                    "
                                >
                                    <field column="content" name="result_indicator_period_actual_document_link_title_narrative"/>
                                </entity>
                            </entity>
                            <entity name="activity_result_indicator_period_actual_document_link_description" 
                                query="
                                    SELECT
                                        id  
                                    FROM iati_documentlinkdescription
                                    WHERE document_link_id=${activity_result_indicator_period_actual_document_link.id}
                                "
                            >
                                <entity name="activity_result_indicator_period_actual_document_link_description_narrative" 
                                    query="
                                        SELECT 
                                            iati_narrative.related_object_id AS related_object_id, 
                                            iati_narrative.content AS content 
                                        FROM iati_narrative, django_content_type 
                                        WHERE iati_narrative.related_object_id=${activity_result_indicator_period_actual_document_link_description.id} 
                                            AND iati_narrative.activity_id=${activity_result.activity_id} 
                                            AND django_content_type.model='documentlinkdescription' 
                                            AND django_content_type.id=iati_narrative.related_content_type_id
                                    "
                                >
                                    <field column="content" name="result_indicator_period_actual_document_link_description_narrative"/>
                                </entity>
                            </entity>
                            <entity name="activity_result_indicator_period_actual_document_link_category" 
                                query="
                                    SELECT
                                        category_id  
                                    FROM iati_documentlinkcategory 
                                    WHERE document_link_id=${activity_result_indicator_period_actual_document_link.id}
                                "
                            >
                                <field column="category_id" name="result_indicator_period_actual_document_link_category_code"/>
                            </entity>
                            <entity name="activity_result_indicator_period_actual_document_link_language" 
                                query="
                                    SELECT
                                        language_id  
                                    FROM iati_documentlinklanguage
                                    WHERE document_link_id=${activity_result_indicator_period_actual_document_link.id}
                                "
                            >
                                <field column="language_id" name="result_indicator_period_actual_document_link_language_code"/>
                            </entity>
                        </entity>    
                    </entity>    
                </entity>      
            </entity>    
        </entity>                         
    </document>
</dataConfig>